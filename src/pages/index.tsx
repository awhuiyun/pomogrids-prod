import Head from "next/head";
import useTaskStore from "@/stores/tasks";
import useSettingStore from "@/stores/settings";
import useToastStore from "@/stores/toast";
import useGridStore from "@/stores/grid";
import TimerContainer from "@/components/TimerContainer";
import TaskContainer from "@/components/TaskContainer";
import SettingsForm from "@/components/SettingsForm";
import TaskForm from "@/components/TaskForm";
import TaskEditMenu from "@/components/TaskEditMenu";
import Grid from "@/components/Grid";
import UnderConstruction from "@/components/UnderConstruction";
import IntroModal from "@/components/IntroModal";
import { useEffect, useState } from "react";

export default function Home() {
  // Global states
  const { tasks, taskFormType, isTaskEditMenuOpen } = useTaskStore();
  const { tasksInTheYear } = useGridStore();
  const { isSettingOpen } = useSettingStore();

  // Local state for Intro modal
  const [isIntroModalOpen, setIsIntroModalOpen] = useState(false);

  useEffect(() => {
    if (tasks.length === 0 && tasksInTheYear.length === 0) {
      setIsIntroModalOpen(true);
    }
  }, []);

  function toggleIntroModalFalse() {
    setIsIntroModalOpen(false);
  }

  return (
    <div>
      <Head>
        <title>Pomogrids</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
      </Head>
      {/************ Modals *************/}
      {/* Intro modal */}
      {isIntroModalOpen && (
        <IntroModal toggleIntroModalFalse={toggleIntroModalFalse} />
      )}

      {/* Settings Form */}
      {isSettingOpen && <SettingsForm />}

      {/* Task Form */}
      {taskFormType && <TaskForm />}

      {/* Task Edit Menu */}
      {isTaskEditMenuOpen && <TaskEditMenu />}

      {/************ Non-Modals *************/}
      {/* Grid section */}
      <Grid />

      {/* Timer and Tasks section */}
      <div className="flex flex-col space-y-4 lg:flex-row lg:space-x-4 lg:space-y-0">
        <TimerContainer />
        <TaskContainer />
      </div>
    </div>
  );
}
